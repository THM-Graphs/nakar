stages:
  - ci
  - deploy

ci_nakar-db-pole:
  stage: ci
  tags: 
      - nodejs
  script:
    - cd nakar-db-pole
    - npm ci

ci_nakar-server:
  stage: ci
  tags: 
      - nodejs
  script:
    - cd nakar-server
    - npm ci
    - npm run build
    - npm run lint
    - npm run audit

ci_nakar-client-web:
  stage: ci
  tags: 
      - nodejs
  script:
    - cd nakar-client-web
    - npm ci
    - npm run build
    - npm run lint
    - npm run audit

deploy_nakar-db-pole:
  stage: deploy
  only:
    - prod
  tags: 
      - docker
  script:
    - cd nakar-db-pole
    - npm run build

deploy_nakar-server:
  stage: deploy
  only:
    - prod
  tags: 
      - docker
  script:
    - cd nakar-server
    - npm run build:docker

deploy_nakar-client-web:
  stage: deploy
  only:
    - prod
  tags: 
      - docker
  script:
    - cd nakar-client-web
    - npm run build:docker